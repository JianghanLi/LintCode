考点

折半枚举 数论

题解

一个显然正确的想法是枚举四个数，判断其乘积是否小于等于kk，但其复杂度为：O(n^4), 明显是会超时的。

考虑折半枚举。

维护两个数组CntCnt，SumSum。
其中Cnt[i]Cnt[i]表示数组中有多少个数小于等于ii。
Sum[i]Sum[i]表示数组中有多少对不重复的数，其乘积小于等于ii。

随后双重循环枚举任意两个数，对于当前两个数a[i],a[j]a[i],a[j]的乘积resres，查询Sum[k/res]Sum[k/res]的值，并将其贡献加入答案。但因为要求一个数不能被重复选择，所以还需要减去Sum[k/res]Sum[k/res]中由a[i]a[i]和a[j]a[j]贡献的答案，故减去Cnt[k/res/a[i]]Cnt[k/res/a[i]]和Cnt[k/res/a[j]]Cnt[k/res/a[j]]的值即可。
另外由容斥定理，a[i]a[i]和a[j]a[j]组成的二元组如果在Sum[k/res]Sum[k/res]中存在贡献，则会被重复减去，故还需要加上被重复减去的部分。

最后因为一个满足题意的四元组，每次枚举两个数，其会被重复枚举C_{4}^{2} = 6C
4
2
​    =6次，故最后的答案除以6，即为最后的正确答案。

总复杂度：O(n^2).